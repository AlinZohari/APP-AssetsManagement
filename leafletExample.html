<html>
<head>
<!--code for Leaflet-->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
crossorigin=""></script>

<style type="text/css">
#mapid {height:180px;}
</style>

<!--The following links incorporate the CSS required for custom icon creation-->
<link rel="stylesheet" href="css/ionicons.min.css">
<link rel="stylesheet" href="css/leaflet.awesome-markers.css">
<script src="js/leaflet.awesome-markers.js"></script>

<!--JQuery: is an Javascript library that makes writing Javascript easier by allowing you to use pre-written code to download data via AJAX -->
<script
src="https://code.jquery.com/jquery-3.4.1.min.js"
integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
crossorigin="anonymous"></script>

</head>

<body>
<!--basic information DIV-->
<div>
	This is my first HTML Page

	My name is: Alin Zohari
	My UCL username is: uceszoh
	My GitHub username is: AlinZohari
</div>

<!--the mapid div will hold the map-->
<div id="mapid" style="width:600px;height:400px;"></div>



<!--the following script will load the map and set the default view and zoom, as wel as loading the basemap title -->

<script>
"use strict";
let mymap; //global variable to store the map

//create a custom popup as a global variable
let popup = L.popup();

//create an event detector to wait for the user's click event and then use the popup to show them where they clicked
//note that you don't need to do any complicated maths to convert screen coordinated to real world coordinates - the Leaflet API does this for you

console.log("function to show the coordinates latlong on click event");
function onMapClick(e){
	popup
		.setLatLng(e.latlng)
		.setContent("You clicked the map at " + e.latlng.toString())
		.openOn(mymap);

}

console.log("function to initialise and create the basemap. Also call on other functions - onMapClick(), addBasicMarkers()");
function loadLeafletMap(){
mymap = L.map('mapid').setView([51.505,-0.09],13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{
	maxZoom:19,
	attribution:'&copy;<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(mymap);

//now add the click event detector to the map- call on the function onMapClick
mymap.on('click',onMapClick);

//now call the code to add the markers
addBasicMarkers();
} //end of code lines adding the leaflet map

console.log("function to create markers in the map");
function addBasicMarkers(){

//adding a custom marker
let testMarkerPink = L.AwesomeMarkers.icon({
	icon:'play',
	markerColor:'pink'
});

//add a circle
	L.circle([51.508,0.11],5000,{
		color:'green',
		fillColor:'#f03',
		fillOpacity:0.8
	}).addTo(mymap).bindPopup("I am a circle.");
console.log("added a circle");

//add a polygon
let myPolygon = L.polygon([
	[51.709,-0.10],
	[51.703,0.07],
	[51.22,0.07],
	[51.22,-0.057]
	],{
	color:'orange',
	fillColor:'#f03',
	fillOpacity:0.5
}).addTo(mymap).bindPopup("I am a polygon in 2022.");
console.log("added a polygon");

//creating a geoJSON feature
let geojsonFeature = {
	"type":"Feature",
	"properties":{
		"name":"London",
		"popupContent":"This is where UCL is based. We have on campus and off campus activity"
	},
	"geometry":{
		"type":"Point",
		"coordinates":[-0.133583,51.524776]
	} 
};

//adding geoJSON feature to the map
L.geoJSON(geojsonFeature,{
	pointToLayer:function(feature,latlng){
		return L.marker(latlng,{icon:testMarkerPink});
	}
}).addTo(mymap).bindPopup("<b>"+geojsonFeature.properties.name+" "+geojsonFeature.properties.popupContent+"<b>");
console.log("added a UCL pinpoint (custom pink) with bold text");

} //end of code lines adding the basic marker
console.log("base map, circle and polygon had been created");


//function to request and map Earthquake data
let earthquakeLayer; //global variable

function getEarthquakeData(){
	let layerURL = 
	"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";
	$.ajax({url:layerURL,crossDomain:true,success:function(result){
			console.log(result);//check the data is correct

			//add the JSON layer onto the map - using custom icon
			earthquakeLayer = L.geoJson(result,{

				//use point to layer to create the points
				pointToLayer: function(feature,latlng){
					//look at the GeoJSON file - specifically at the properties - to see the earthquake magnitude and use a different marker depending on this value

					//also include a pop-up that shows the place of the earthquakes
					if (feature.properties.mag>1.75){
						return L.marker(latlng,{icon:testMarkerGreen}).bindPopup("<b>"+feature.properties.place+"</b>");
					}
					else {
						//magnitude is 1.75 or less
						return L.marker(latlng,{icon:testMarkerPink}).bindPopup("<b>"+feature.properties.place+"</b>");
					}
				},//end of point to layer
			}).addTo(mymap);

			//change the map zoom so that all the data is shown
			mymap.fitBounds(earthquakeLayer.getBounds());

		 }//end of the inner function
		}); //end of the ajax request

	let testMarkerGreen = L.AwesomeMarkers.icon({
		icon:'play',
		marketColor:'green'
	});
	let testMarkerPink = L.AwesomeMarkers.icon({
		icon:'play',
		markerColor:'pink'
	});


} //end of the getEarthquakeData function


//loading the leaflet map and Eartquake (AFTER)
document.addEventListener('DOMContentLoaded', function(){
	loadMap();
},false);

function loadMap(){
	loadLeafletMap();
	getEarthquakeData();
}

</script>
</body>
</html>
